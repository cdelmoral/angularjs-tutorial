"use strict";!function(){angular.module("angularjsTutorial",["angularjsTutorial.core","angularjsTutorial.sessions","angularjsTutorial.page","angularjsTutorial.users","angularjsTutorial.passwordResets"])}(),function(){angular.module("angularjsTutorial.constants",[]).constant("environment",{ENV:"production",SERVER_URL:"https://cdelmoral-angularjstutorial.herokuapp.com"})}(),function(){angular.module("angularjsTutorial.common",[])}(),function(){angular.module("angularjsTutorial.core",["angular-flash.flash-alert-directive"])}(),function(){angular.module("angularjsTutorial.microposts",["angularjsTutorial.sessions","angularjsTutorial.common"])}(),function(){angular.module("angularjsTutorial.page",["ngRoute","angularjsTutorial.common","angularjsTutorial.microposts","angularjsTutorial.users"])}(),function(){angular.module("angularjsTutorial.passwordResets",["angularjsTutorial.common","angularjsTutorial.page"])}(),function(){angular.module("angularjsTutorial.sessions",["angular-flash.service","angular-flash.flash-alert-directive","angularjsTutorial.common","angularjsTutorial.page","angularjsTutorial.constants"])}(),function(){angular.module("angularjsTutorial.users",["ngResource","ngMessages","angularUtils.directives.dirPagination","angular-flash.service","angular-flash.flash-alert-directive","angularjsTutorial.common","angularjsTutorial.page","angularjsTutorial.constants","angularjsTutorial.microposts"])}(),function(){function a(){function a(a,b,c){var d=c.confirm||"Are you sure?";b.bind("click",function(a){confirm(d)||(a.stopImmediatePropagation(),a.preventDefault)})}var b={restrict:"A",link:{pre:a}};return b}angular.module("angularjsTutorial.common").directive("atConfirm",a)}(),function(){function a(){function a(a,b,c,d){function e(b,c){var d=b||c;return d===a.password}d.$validators.atConfirmPassword=e,a.$watch("password",function(){d.$validate()})}var b={require:"ngModel",scope:{password:"=atConfirmPassword"},link:a};return b}angular.module("angularjsTutorial.common").directive("atConfirmPassword",a)}(),function(){function a(a){function b(a){function b(){h=!1,g&&g.$setPristine()}function c(){h=!0}function d(a){g=a}function e(a){return g?a?a.$invalid&&(a.$dirty||h):g&&g.$invalid&&(g.$dirty||h):!1}var f=this,g=null,h=!1;f.setFormCtrl=d,f.needsAttention=e,f.setAttempted=c,f.resetSubmission=b}function c(b,c,d){function e(a,b,c,d){var e=d[0],f=d.length>1?d[1]:null;e.setFormCtrl(f),a.at=a.at||{},a.at[c.name]=e}function f(b,c,d,e){var f=e[0],g=e.length>1?e[1]:null,h=a(d.atSubmit);c.bind("submit",function(a){return b.$apply(function(){f.setAttempted()}),g.$valid?void b.$apply(function(){h(b,{$event:a}),f.resetSubmission()}):!1})}var g={pre:e,post:f};return g}var d={restrict:"A",require:["atSubmit","?form"],controller:b,compile:c};return b.$inject=["$scope"],d}angular.module("angularjsTutorial.common").directive("atSubmit",a),a.$inject=["$parse"]}(),function(){function a(a,b,c){function d(c,d,e,f){function g(d,f){var g=b.defer(),h=d||f,i=a(e.atValidateUnique);return i(c,{value:h}).then(function(){g.resolve()},function(){g.reject()}),g.promise}f.$asyncValidators.atValidateUnique=g}var e={restrict:"A",require:"ngModel",link:d};return e}angular.module("angularjsTutorial.common").directive("atValidateUnique",a),a.$inject=["$parse","$q","UsersService"]}(),function(){function a(a,b){var c=this;c.userLoggedIn=!1,c.currentUser=null,a.$on(b.LOGGING_EVENT,function(){c.userLoggedIn=null!==b.currentUser,c.currentUser=b.currentUser})}angular.module("angularjsTutorial.core").controller("HeaderCtrl",a),a.$inject=["$scope","SessionsService"]}(),function(){function a(){function a(a,b,c,d){function e(){return b.user.id===c.currentUser.id}function f(){d.deleteMicropost(b.user.id,b.micropost.id),a.reload()}function g(a){function b(a,b){return function(c){return(c/a).toFixed()+" "+b+" ago"}}for(var c=Date.now(),d=(c-Date.parse(a))/6e4,e=[[1,"less than a minute ago"],[2,"a minute ago"],[45,b(1,"minutes")],[90,"about 1 hour ago"],[1440,b(60,"hours")],[2880,"1 day ago"],[43200,b(1440,"days")],[86400,"about 1 month ago"],[52960,b(43200,"months")],[1051200,"about 1 year ago"],[Number.MAX_VALUE,b(525960,"years")]],f=null,g=0;g<e.length&&null===f;g++)d<=e[g][0]&&(f=e[g][1]instanceof Function?e[g][1](d):e[g][1]);return null===f?"a long time ago":f}var h=this;h.CONFIRM="Are you sure you want to delete this micropost?",h.timeAgoInWords=g,h.isCurrentUser=e,h.deleteMicropost=f}var b={restrict:"E",scope:{micropost:"=",user:"="},controller:a,controllerAs:"ctrl",templateUrl:"components/microposts/micropost.html"};return a.$inject=["$route","$scope","SessionsService","UsersService"],b}angular.module("angularjsTutorial.microposts").directive("atMicropost",a)}(),function(){function a(a,b,c){function d(a,b,c){f.userMicropostPage.page=b,f.userMicropostPage.itemsPerPage=c,f.userMicropostPage.userId=a;var d={userId:a,pageNumber:b,itemsPerPage:c};g.micropostsPageForUser(d).$promise.then(function(a){f.userMicropostPage.microposts=a.microposts,f.userMicropostPage.totalItems=a.count})}function e(a,b,c){var d={userId:a,pageNumber:b,itemsPerPage:c};return g.micropostsFeedPageForUser(d).$promise}var f={};f.userMicropostPage={microposts:[],userId:null,page:1,itemsPerPage:7,totalItems:0},f.getMicropostsPage=d,f.getMicropostsFeedPageForUser=e;var g=b(c.SERVER_URL+"/api/microposts/:id",{},{micropostsPageForUser:{method:"GET",params:{pageNumber:1,itemsPerPage:8},url:c.SERVER_URL+"/api/microposts/user_page/:userId"},micropostsFeedPageForUser:{method:"GET",params:{pageNumber:1,itemsPerPage:8},url:c.SERVER_URL+"/api/microposts/feed/:userId"}});return f}angular.module("angularjsTutorial.microposts").factory("MicropostsService",a),a.$inject=["$q","$resource","environment"]}(),function(){function a(a){a.setPageTitle("About")}angular.module("angularjsTutorial.page").controller("AboutCtrl",a),a.$inject=["PageSvc"]}(),function(){function a(a){a.setPageTitle("Contact")}angular.module("angularjsTutorial.page").controller("ContactCtrl",a),a.$inject=["PageSvc"]}(),function(){function a(a){a.setPageTitle("Help")}angular.module("angularjsTutorial.page").controller("HelpCtrl",a),a.$inject=["PageSvc"]}(),function(){function a(a,b,c,d){function e(){j.currentUser=b.currentUser,j.userLoggedIn=null!==j.currentUser,a.setPageTitle("Home"),j.userLoggedIn&&h(j.pagination.pageNumber)}function f(a,b){return 1===a?"1 "+b:1>a?"0 "+b+"s":a+" "+b+"s"}function g(){i||(i=!0,d.createMicropost(j.currentUser.id,{content:j.micropostContent}).then(function(a){i=!1,b.login(a),j.currentUser=a,j.micropostContent=null,h(j.pagination.pageNumber)}))}function h(a){j.pagination.page=a,c.getMicropostsFeedPageForUser(j.currentUser.id,a,j.pagination.pageItems).then(function(a){j.microposts=a.microposts,j.pagination.total=a.count})}var i,j=this;j.userLoggedIn=!1,j.currentUser={},j.currentUserCount=0,j.micropostContent=null,j.microposts=[],j.pagination={page:1,pageItems:7,total:0},j.pluralize=f,j.createMicropost=g,j.getMicropostFeedPage=h,e()}angular.module("angularjsTutorial.page").controller("HomeCtrl",a),a.$inject=["PageSvc","SessionsService","MicropostsService","UsersService"]}(),function(){function a(a){function c(c){c&&""!==c?a.title=c+" - "+b:a.title=b}var d=this;return d.setPageTitle=c,d}angular.module("angularjsTutorial.page").factory("PageSvc",a);var b="AngularJS Tutorial";a.$inject=["$rootScope"]}(),function(){function a(a,b,c,d,e){function f(){e.updatePassword(i,j,h.password).then(function(b){c.success=b,a.path("/login").replace()})["catch"](function(b){c.error=b,a.path("/").replace()})}function g(){d.setPageTitle("Reset password"),i=b.id,j=b.token,e.validateToken(i,j).then(function(){h.showForm=!0})["catch"](function(b){c.error=b,a.path("/").replace()})}var h=this;h.showForm=!1,h.password=null,h.confirmation=null;var i=null,j=null;h.updatePassword=f,g()}angular.module("angularjsTutorial.passwordResets").controller("PasswordResetsEditCtrl",a),a.$inject=["$location","$routeParams","flash","PageSvc","PasswordResetsService"]}(),function(){function a(a,b,c,d){function e(){h||(h=!0,c.createToken(g.email).then(function(b){d.success=b,a.path("/").replace()})["catch"](function(b){d.error=b,a.path("/").replace()}))}function f(){b.setPageTitle("Forgot Password")}var g=this;g.email=null,g.createResetToken=e;var h=!1;f()}angular.module("angularjsTutorial.passwordResets").controller("PasswordResetsNewCtrl",a),a.$inject=["$location","PageSvc","PasswordResetsService","flash"]}(),function(){function a(a,b,c){function d(b,c){var d=a.defer();return h.validateToken({id:b,token:c},function(a){d.resolve()},function(a){d.reject(a.data)}),d.promise}function e(b){var c=a.defer();return h.createToken({email:b},function(a){c.resolve(a.message)},function(a){c.reject(a.data)}),c.promise}function f(b,c,d){var e=a.defer();return h.updatePassword({id:b,token:c},{password:d},function(a){e.resolve(a.message)},function(a){e.reject(a.data)}),e.promise}var g=this;g.createToken=e,g.updatePassword=f,g.validateToken=d;var h=b(c.SERVER_URL+"/api/password_resets/:id/:token",{},{validateToken:{method:"GET",url:c.SERVER_URL+"/api/password_resets/valid_token"},updatePassword:{method:"PUT"},createToken:{method:"POST"}});return g}angular.module("angularjsTutorial.passwordResets").factory("PasswordResetsService",a),a.$inject=["$q","$resource","environment"]}(),function(){function a(a,b){function c(){null!==b.currentUser&&b.logout(),a.path("/home").replace()}c()}angular.module("angularjsTutorial.sessions").controller("SessionsDeleteCtrl",a),a.$inject=["$location","SessionsService"]}(),function(){function a(a,b,c,d){function e(){d.authenticate(g.user).then(function(c){b.success="Welcome!",null===d.beforeLoginAttempt?a.path("/users/"+c.id).replace():(a.path(d.beforeLoginAttempt).replace(),d.beforeLoginAttempt=null)})["catch"](function(c){b.error=c,a.path("/login").replace()})}function f(){d.currentUser&&a.path("/users/"+d.currentUser.id).replace(),c.setPageTitle("Log in")}var g=this;g.user={},g.createSession=e,f()}angular.module("angularjsTutorial.sessions").controller("SessionsNewCtrl",a),a.$inject=["$location","flash","PageSvc","SessionsService"]}(),function(){function a(a,b,c,d,e,f){function g(){return null!==n.currentUser&&n.currentUser.admin}function h(a){var c=b.defer();return o.authenticate(a,function(a){a.id&&(n.currentUser=a,d.$broadcast(n.LOGGING_EVENT),c.resolve(n.currentUser))},function(a){(403===a.status||401===a.status)&&c.reject(a.data)}),c.promise}function i(a){n.currentUser=a,d.$broadcast(n.LOGGING_EVENT)}function j(){o.logout(),n.currentUser=null,d.$broadcast(n.LOGGING_EVENT),a.path("/home").replace()}function k(){null===n.currentUser&&(n.beforeLoginAttempt=a.path(),f.error="You need to be logged in to access this page",a.path("/login").replace())}function l(b){k(),n.currentUser.id!==b&&(f.error="You don't have permissions to access this page.",a.path("/users/"+n.currentUser.id))}function m(){var a=b.defer();o.authenticated(function(b){b&&b.id&&(n.currentUser=b,d.$broadcast(n.LOGGING_EVENT)),a.resolve()}),n.initAuthPromise=a.promise}var n=this;n.LOGGING_EVENT="LoggingEvent",n.initAuthPromise=null,n.currentUser=null,n.beforeLoginAttempt=null,n.authenticate=h,n.login=i,n.logout=j,n.initialize=m,n.requireLogin=k,n.requireCorrectUser=l,n.currentUserIsAdmin=g;var o=c(e.SERVER_URL+"/api/sessions",{},{authenticate:{method:"POST"},authenticated:{method:"GET",url:e.SERVER_URL+"/api/sessions/authenticated"},logout:{method:"DELETE",url:e.SERVER_URL+"/api/sessions/logout"}});return n}angular.module("angularjsTutorial.sessions").factory("SessionsService",a),a.$inject=["$location","$q","$resource","$rootScope","environment","flash"]}(),function(){function a(a,b,c,d,e,f){function g(){d.setPageTitle("Activate user"),h=b.id,i=b.token,f.activateUser(h,i).then(function(b){e.login(b.user),c.success=b.message,a.path("/users/"+h).replace()})["catch"](function(b){c.error=b,a.path("/").replace()})}var h=null,i=null;g()}angular.module("angularjsTutorial.users").controller("UsersActivationCtrl",a),a.$inject=["$location","$routeParams","flash","PageSvc","SessionsService","UsersService"]}(),function(){function a(a,b,c,d,e,f,g){function h(){var b={id:e.currentUser.id,name:l.editUser.username,email:l.editUser.email,password:l.editUser.password};f.updateUser(b).then(function(b){g.success=b.message,e.login(b.user),a.path(f.userPath(b.user)).replace()})}function i(a){return f.isNameUnique(a)}function j(a){return f.isEmailUnique(a)}function k(){d.setPageTitle("Edit user"),e.requireCorrectUser(c.id),l.editUser.username=e.currentUser.name,l.editUser.email=e.currentUser.email}var l=this;l.editUser={},l.updateUser=h,l.isNameUnique=i,l.isEmailUnique=j,k()}angular.module("angularjsTutorial.users").controller("UsersEditCtrl",a),a.$inject=["$location","$q","$routeParams","PageSvc","SessionsService","UsersService","flash"]}(),function(){function a(a,b,c){function d(a){g.pagination.page=a,c.getUsersPage(g.pagination.page,g.pagination.itemsPerPage).then(function(a){g.users=a.users,g.pagination.totalItems=a.count})}function e(a){c.deleteUser(a).then(function(){d(g.pagination.page)})}function f(){a.setPageTitle("Users"),b.requireLogin(),d(g.pagination.page)}var g=this;g.CONFIRM="Are you sure you want to delete the User?",g.users=[],g.pagination={page:1,totalItems:0,itemsPerPage:10},g.currentUserIsAdmin=b.currentUserIsAdmin,g.getUsersPage=d,g.deleteUser=e,f()}angular.module("angularjsTutorial.users").controller("UsersIndexCtrl",a),a.$inject=["PageSvc","SessionsService","UsersService"]}(),function(){function a(a,b,c,d,e){function f(){k||(k=!0,d.createUser(j.newUser).then(function(b){k=!1,e.success=b.message,a.path("/").replace()}))}function g(a){return d.isNameUnique(a)}function h(a){return d.isEmailUnique(a)}function i(){b.setPageTitle("Sign up"),c.currentUser&&a.path(d.userPath(c.currentUser)).replace()}var j=this;j.newUser={},j.confirmation=null,j.createUser=f,j.isNameUnique=g,j.isEmailUnique=h;var k=!1;i()}angular.module("angularjsTutorial.users").controller("UsersNewCtrl",a),a.$inject=["$location","PageSvc","SessionsService","UsersService","flash"]}(),function(){function a(a,b,c){function d(a){return o.save(a).$promise}function e(a,b){return o.createMicropost({id:a},b).$promise}function f(a){return o.update({id:a.id},a).$promise}function g(a,b){var c={pageNumber:a,usersPerPage:b};return o.queryPage(c).$promise}function h(a){return o.get({id:a}).$promise}function i(a){return o["delete"]({id:a.id}).$promise}function j(a){return a&&a.id?"/users/"+a.id:void 0}function k(b){var c=a.defer();return o.isNameAvailable({name:b}).$promise.then(function(a){a&&a.valid?c.resolve():c.reject()}),c.promise}function l(b){var c=a.defer();return o.isEmailAvailable({email:b}).$promise.then(function(a){a&&a.valid?c.resolve():c.reject()}),c.promise}function m(b,c){var d=a.defer();return o.activateUser({id:b,token:c},{},function(a){d.resolve(a)},function(a){d.reject(a.data)}),d.promise}var n={},o=b(c.SERVER_URL+"/api/users/:id",{},{queryPage:{method:"GET",params:{pageNumber:1,usersPerPage:25},url:c.SERVER_URL+"/api/users/index_page"},update:{method:"PUT"},isNameAvailable:{method:"GET",url:c.SERVER_URL+"/api/users/is_unique"},isEmailAvailable:{method:"GET",url:c.SERVER_URL+"/api/users/is_unique"},activateUser:{method:"PUT",url:c.SERVER_URL+"/api/users/activate/:id/:token"},createMicropost:{method:"PUT",url:c.SERVER_URL+"/api/users/new_micropost/:id"},deleteMicropost:{method:"DELETE",url:c.SERVER_URL+"/api/users/:id/:micropost_id"}});return n.createUser=d,n.updateUser=f,n.getUsersPage=g,n.getUser=h,n.userPath=j,n.isNameUnique=k,n.isEmailUnique=l,n.activateUser=m,n.createMicropost=e,n.deleteUser=i,n.deleteMicropost=function(a,b){o.deleteMicropost({id:a,micropost_id:b})},n}angular.module("angularjsTutorial.users").factory("UsersService",a),a.$inject=["$q","$resource","environment"]}(),function(){function a(a,b,c,d,e,f){function g(){d.setPageTitle("Show user"),e.requireLogin(),f.getUser(a.id).then(function(a){i.user=a,h(1)})}function h(a){c.getMicropostsPage(i.user.id,a,c.userMicropostPage.itemsPerPage)}var i=this;i.user={},i.micropostPage=c.userMicropostPage,i.getMicropostsPage=h,g()}angular.module("angularjsTutorial.users").controller("UsersShowCtrl",a),a.$inject=["$routeParams","$scope","MicropostsService","PageSvc","SessionsService","UsersService"]}(),function(){function a(a){a.initialize()}function b(a,b){function c(a){return a.initAuthPromise}delete a.defaults.headers.common["X-Requested-With"];var d={auth:c};c.$inject=["SessionsService"],b.when("/home",{templateUrl:"components/page/home.html",controller:"HomeCtrl",controllerAs:"ctrl",resolve:d}).when("/help",{templateUrl:"components/page/help.html",controller:"HelpCtrl",resolve:d}).when("/about",{templateUrl:"components/page/about.html",controller:"AboutCtrl",resolve:d}).when("/contact",{templateUrl:"components/page/contact.html",controller:"ContactCtrl",resolve:d}).when("/sign-up",{templateUrl:"components/users/users-new.html",controller:"UsersNewCtrl",controllerAs:"ctrl",resolve:d}).when("/users",{templateUrl:"components/users/users-index.html",controller:"UsersIndexCtrl",controllerAs:"ctrl",resolve:d}).when("/users/:id",{templateUrl:"components/users/users-show.html",controller:"UsersShowCtrl",controllerAs:"ctrl",resolve:d}).when("/users/:id/edit",{templateUrl:"components/users/users-edit.html",controller:"UsersEditCtrl",controllerAs:"ctrl",resolve:d}).when("/users/activate/:id/:token",{template:" ",controller:"UsersActivationCtrl",resolve:d}).when("/login",{templateUrl:"components/sessions/sessions-new.html",controller:"SessionsNewCtrl",controllerAs:"ctrl",resolve:d}).when("/logout",{template:" ",controller:"SessionsDeleteCtrl",resolve:d}).when("/password_resets",{templateUrl:"components/password-resets/password-resets-new.html",controller:"PasswordResetsNewCtrl",controllerAs:"ctrl",resolve:d}).when("/password_resets/:id/:token",{templateUrl:"components/password-resets/password-resets-edit.html",controller:"PasswordResetsEditCtrl",controllerAs:"ctrl",resolve:d}).otherwise({redirectTo:"/home"})}angular.module("angularjsTutorial").run(a).config(b),a.$inject=["SessionsService"],b.$inject=["$httpProvider","$routeProvider"]}();